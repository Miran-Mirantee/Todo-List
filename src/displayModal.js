import project from "./project";
import todo from "./todo";
import projectList from "./projectList";
import displayProject from "./displayProject";
import setAttributes from "./setAttrs";

// create a field container use in modal
const _createFieldContainer = (form, type, labelTxt, name) => {
    const container = document.createElement('div');
    container.classList.add('modal', 'input-container');
    const label = document.createElement('label');
    setAttributes(label, {'for': name});
    label.textContent = `${labelTxt}:`;
    const field = document.createElement('input');
    setAttributes(field, {'type': type, 'id': name, 'name': name});
    container.append(label, field);
    form.append(container);
};

// display a "add todo to project" modal
const displayAddTodoModal = (project) => {
    const modal = document.createElement('div');
    modal.classList.add('todo', 'modal-background');
    
    const modalContent = document.createElement('div');
    modalContent.classList.add('todo', 'modal-content');

    const topPanel = document.createElement('div');
    topPanel.classList.add('modal', 'top-panel');

    const header = document.createElement('div');
    header.classList.add('modal', 'header');
    header.textContent = 'Add new todo'

    const closeBtn = document.createElement('span');
    closeBtn.classList.add('modal', 'close', 'btn');
    closeBtn.textContent = 'X';
    closeBtn.addEventListener('click', () => modal.remove());

    const inputForm = document.createElement('form');
    setAttributes(inputForm, {'action': 'javascript:;', 'method': 'post'});
    inputForm.classList.add('modal', 'input-form');

    // input fields
    _createFieldContainer(inputForm, 'text', 'Title', 'title');
    _createFieldContainer(inputForm, 'text', 'Description', 'desc');
    _createFieldContainer(inputForm, 'date', 'Due date', 'due_date');
    _createFieldContainer(inputForm, 'text', 'Priority', 'priority');

    const bottomPanel = document.createElement('div');
    bottomPanel.classList.add('modal', 'bottom-panel');

    // create new todo
    const createBtn = document.createElement('button');
    setAttributes(createBtn, {'type': 'submit'});
    createBtn.classList.add('modal', 'btn', 'create-todo');
    createBtn.textContent = 'Create';
    createBtn.addEventListener('click', () => {
        project.addTodo(
            new todo(
                document.getElementById('title').value,
                document.getElementById('desc').value,
                document.getElementById('due_date').value,
                document.getElementById('priority').value
            )
        );
        modal.remove();
    });

    // cancel
    const cancelBtn = document.createElement('button')
    setAttributes(cancelBtn, {'type': 'reset'});
    cancelBtn.classList.add('modal', 'btn', 'cancel');
    cancelBtn.textContent = 'Cancel';
    cancelBtn.addEventListener('click', () => modal.remove());
    bottomPanel.append(cancelBtn, createBtn);

    inputForm.append(bottomPanel);
    topPanel.append(header, closeBtn);
    modalContent.append(topPanel, inputForm);
    modal.append(modalContent)
    document.body.prepend(modal);
};

// display a "add project to a list of projects" modal
const displayAddProjectModal = () => {
    const modal = document.createElement('div');
    modal.classList.add('project', 'modal-background');

    const modalContent = document.createElement('div');
    modalContent.classList.add('project', 'modal-content');

    const topPanel = document.createElement('div');
    topPanel.classList.add('modal', 'top-panel');

    const header = document.createElement('div');
    header.classList.add('modal', 'header');
    header.textContent = 'Add new project'

    const closeBtn = document.createElement('span');
    closeBtn.classList.add('modal', 'close', 'btn');
    closeBtn.textContent = 'X';
    closeBtn.addEventListener('click', () => modal.remove());

    const inputForm = document.createElement('form');
    setAttributes(inputForm, {'action': 'javascript:;', 'method': 'post'});
    inputForm.classList.add('modal', 'input-form');

    _createFieldContainer(inputForm, 'text', 'Project Name', 'project_name');

    const bottomPanel = document.createElement('div');
    bottomPanel.classList.add('modal', 'bottom-panel');

    // create new project
    const createBtn = document.createElement('button');
    setAttributes(createBtn, {'type': 'submit'});
    createBtn.classList.add('modal', 'btn', 'create-project');
    createBtn.textContent = 'Create';
    createBtn.addEventListener('click', () => {
        let newProject = new project(document.getElementById('project_name').value);
        projectList.push(newProject);
        displayProject(projectList, newProject);
        modal.remove();
    });

    // cancel
    const cancelBtn = document.createElement('button')
    setAttributes(cancelBtn, {'type': 'reset'});
    cancelBtn.classList.add('modal', 'btn', 'cancel');
    cancelBtn.textContent = 'Cancel';
    cancelBtn.addEventListener('click', () => modal.remove());
    bottomPanel.append(cancelBtn, createBtn);

    inputForm.append(bottomPanel);
    topPanel.append(header, closeBtn);
    modalContent.append(topPanel, inputForm);
    modal.append(modalContent);
    document.body.prepend(modal);
};

export {
    displayAddProjectModal, 
    displayAddTodoModal,
};